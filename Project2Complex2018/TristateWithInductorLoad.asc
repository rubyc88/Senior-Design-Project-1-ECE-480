Version 4
SHEET 1 4296 696
WIRE 1200 -1088 1200 -1136
WIRE 1328 -1088 1328 -1104
WIRE 1440 -1088 1440 -1136
WIRE 1536 -1088 1536 -1104
WIRE 1632 -1088 1632 -1104
WIRE 1200 -1056 1200 -1088
WIRE 1328 -1056 1328 -1088
WIRE 1440 -1056 1440 -1088
WIRE 1536 -1056 1536 -1088
WIRE 1632 -1056 1632 -1088
WIRE 2464 -1056 2304 -1056
WIRE 2640 -1056 2464 -1056
WIRE 2304 -992 2304 -1056
WIRE 2304 -992 2288 -992
WIRE 2336 -992 2304 -992
WIRE 2464 -992 2464 -1056
WIRE 2464 -992 2416 -992
WIRE 2528 -992 2464 -992
WIRE 2640 -992 2640 -1056
WIRE 2640 -992 2608 -992
WIRE 2688 -992 2640 -992
WIRE 2864 -992 2768 -992
WIRE 3152 -992 2864 -992
WIRE 3536 -992 3152 -992
WIRE 2464 -976 2464 -992
WIRE 1200 -944 1200 -976
WIRE 1328 -944 1328 -976
WIRE 1440 -944 1440 -976
WIRE 1536 -944 1536 -976
WIRE 1632 -944 1632 -976
WIRE 2464 -880 2464 -912
WIRE 2720 -832 2624 -832
WIRE 2864 -832 2864 -992
WIRE 2864 -832 2720 -832
WIRE 3536 -832 3536 -992
WIRE 3696 -832 3536 -832
WIRE 3760 -832 3696 -832
WIRE 2720 -816 2720 -832
WIRE 3696 -816 3696 -832
WIRE 2064 -800 2064 -832
WIRE 2624 -800 2624 -832
WIRE 3760 -800 3760 -832
WIRE 2224 -784 2208 -784
WIRE 2272 -784 2224 -784
WIRE 1840 -768 1840 -784
WIRE 1344 -752 1344 -784
WIRE 1424 -752 1344 -752
WIRE 1776 -752 1712 -752
WIRE 1344 -736 1344 -752
WIRE 2864 -736 2864 -832
WIRE 3536 -736 3536 -832
WIRE 1952 -720 1920 -720
WIRE 1968 -720 1952 -720
WIRE 2016 -720 1968 -720
WIRE 2208 -720 2208 -784
WIRE 2208 -720 2160 -720
WIRE 2624 -720 2624 -736
WIRE 2720 -720 2720 -736
WIRE 2720 -720 2624 -720
WIRE 2768 -720 2720 -720
WIRE 2816 -720 2768 -720
WIRE 3664 -720 3584 -720
WIRE 3696 -720 3696 -736
WIRE 3696 -720 3664 -720
WIRE 3760 -720 3760 -736
WIRE 3760 -720 3696 -720
WIRE 1968 -688 1936 -688
WIRE 2624 -688 2624 -720
WIRE 3760 -688 3760 -720
WIRE 2208 -656 2160 -656
WIRE 3120 -656 3104 -656
WIRE 3216 -656 3184 -656
WIRE 1344 -640 1344 -656
WIRE 1424 -640 1344 -640
WIRE 1936 -640 1936 -688
WIRE 1344 -624 1344 -640
WIRE 2208 -592 2208 -656
WIRE 2240 -592 2208 -592
WIRE 2272 -592 2240 -592
WIRE 2480 -592 2464 -592
WIRE 2624 -592 2624 -624
WIRE 3760 -592 3760 -624
WIRE 3808 -592 3760 -592
WIRE 1472 -576 1424 -576
WIRE 1600 -576 1552 -576
WIRE 2864 -560 2864 -640
WIRE 2864 -560 2832 -560
WIRE 2976 -560 2864 -560
WIRE 3072 -560 3056 -560
WIRE 3104 -560 3104 -656
WIRE 3104 -560 3072 -560
WIRE 3120 -560 3104 -560
WIRE 3216 -560 3216 -656
WIRE 3216 -560 3200 -560
WIRE 3248 -560 3216 -560
WIRE 3280 -560 3248 -560
WIRE 3536 -560 3536 -640
WIRE 3536 -560 3360 -560
WIRE 3568 -560 3536 -560
WIRE 1072 -544 1072 -592
WIRE 2336 -528 2336 -720
WIRE 1344 -512 1344 -544
WIRE 1424 -480 1424 -576
WIRE 1472 -480 1424 -480
WIRE 1600 -480 1600 -576
WIRE 1600 -480 1536 -480
WIRE 2864 -432 2864 -560
WIRE 3136 -432 2864 -432
WIRE 3536 -432 3536 -560
WIRE 3536 -432 3184 -432
WIRE 2064 -416 2064 -464
WIRE 2864 -416 2864 -432
WIRE 3536 -416 3536 -432
WIRE 1056 -400 1040 -400
WIRE 1072 -400 1072 -464
WIRE 1072 -400 1056 -400
WIRE 1152 -400 1136 -400
WIRE 1216 -400 1152 -400
WIRE 1312 -400 1296 -400
WIRE 1360 -400 1312 -400
WIRE 1424 -400 1424 -480
WIRE 1424 -400 1360 -400
WIRE 1472 -400 1424 -400
WIRE 1600 -400 1600 -480
WIRE 1600 -400 1520 -400
WIRE 1664 -400 1600 -400
WIRE 1712 -400 1712 -752
WIRE 1712 -400 1664 -400
WIRE 2240 -400 2208 -400
WIRE 2272 -400 2240 -400
WIRE 2496 -400 2464 -400
WIRE 1520 -384 1520 -400
WIRE 1600 -384 1600 -400
WIRE 1840 -384 1840 -400
WIRE 3136 -384 3136 -432
WIRE 3184 -384 3184 -432
WIRE 1472 -368 1472 -400
WIRE 1040 -336 1040 -400
WIRE 1936 -336 1920 -336
WIRE 1968 -336 1936 -336
WIRE 2016 -336 1968 -336
WIRE 2208 -336 2208 -400
WIRE 2208 -336 2160 -336
WIRE 2336 -336 2336 -528
WIRE 2768 -336 2752 -336
WIRE 2816 -336 2768 -336
WIRE 3120 -336 3024 -336
WIRE 3232 -336 3200 -336
WIRE 3616 -336 3584 -336
WIRE 1712 -304 1712 -400
WIRE 1776 -304 1712 -304
WIRE 1968 -304 1936 -304
WIRE 2864 -304 2864 -320
WIRE 3536 -304 3536 -320
WIRE 1472 -288 1472 -320
WIRE 1472 -288 1440 -288
WIRE 2208 -272 2160 -272
WIRE 1520 -256 1520 -304
WIRE 1600 -256 1600 -304
WIRE 1600 -256 1520 -256
WIRE 1936 -256 1936 -304
WIRE 1520 -240 1520 -256
WIRE 2208 -224 2208 -272
WIRE 2256 -224 2208 -224
WIRE 2272 -224 2256 -224
WIRE 1040 -208 1040 -256
WIRE 2336 -160 2336 -336
WIRE 1312 -112 1312 -400
WIRE 1792 -112 1312 -112
WIRE 2880 -112 1872 -112
WIRE 3024 -112 3024 -336
WIRE 3024 -112 2880 -112
WIRE 2336 -32 2336 -160
FLAG 1040 -208 0
FLAG 1056 -400 Vin
FLAG 1536 -944 0
FLAG 1536 -1088 Vdd
FLAG 1344 -512 0
FLAG 1344 -864 VDD
FLAG 1424 -640 Vref2
FLAG 2864 -304 0
FLAG 2288 -992 Vs
FLAG 1632 -944 0
FLAG 1632 -1088 Vs
FLAG 2768 -720 Vg2
FLAG 1424 -752 Vref1
FLAG 1360 -400 Vsum
FLAG 3536 -304 0
FLAG 3664 -720 Vg4
FLAG 2880 -112 Vfb
FLAG 2832 -560 VoL
FLAG 3568 -560 VoR
FLAG 1152 -400 Vindc
FLAG 1440 -944 0
FLAG 1440 -1088 clock
FLAG 1520 -240 0
FLAG 3280 -864 Vfilter
FLAG 1328 -944 0
FLAG 1328 -1088 VCM
FLAG 3232 -336 VCM
FLAG 1440 -288 VCM
FLAG 3616 -336 Vg3
FLAG 3808 -592 Vg4b
FLAG 3072 -912 VoL
FLAG 3072 -816 VoR
FLAG 3072 -560 Vll
FLAG 3248 -560 Vlr
FLAG 2464 -880 0
FLAG 3152 -992 Vsd
FLAG 2768 -336 Vg1
FLAG 2624 -592 Vg2b
FLAG 1840 -400 Vdd
FLAG 1776 -688 Vref1
FLAG 1840 -784 Vdd
FLAG 1776 -368 Vref2
FLAG 1664 -400 Vint
FLAG 2496 -400 Vg1
FLAG 2464 -784 Vg3
FLAG 2464 -224 Vg4b
FLAG 2480 -592 Vg2b
FLAG 2368 -832 Vdd
FLAG 2368 -640 Vdd
FLAG 2368 -448 Vdd
FLAG 2368 -272 Vdd
FLAG 2368 -736 0
FLAG 2368 -544 0
FLAG 2368 -352 0
FLAG 2368 -176 0
FLAG 1936 -640 clock
FLAG 1952 -720 Comp1
FLAG 2064 -832 Q2
FLAG 1936 -256 clock
FLAG 1936 -336 Comp2
FLAG 2064 -464 Q1
FLAG 2064 -576 Vdd
FLAG 2064 -192 Vdd
FLAG 2256 -224 _Q2
FLAG 2224 -784 Q1
FLAG 2240 -400 Q2
FLAG 2240 -592 _Q1
FLAG 2336 -32 _POR
FLAG 1200 -944 0
FLAG 1200 -1088 _POR
FLAG 1072 -592 0
SYMBOL voltage 1040 -352 R0
WINDOW 123 48 45 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 45 69 Left 2
WINDOW 0 6 15 Left 2
SYMATTR Value2 AC 1
SYMATTR Value SINE(0 0.5 {freq})
SYMATTR InstName Vin
SYMBOL voltage 1536 -1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VDD
SYMATTR Value 5
SYMBOL res 1200 -384 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {Rin}
SYMBOL cap 1536 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cint
SYMATTR Value {Cint}
SYMATTR Value2 ic=0
SYMBOL res 1776 -96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value {Rf}
SYMBOL res 1328 -752 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res 1360 -768 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL voltage 1632 -1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vs
SYMATTR Value 12
SYMBOL res 2736 -720 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res 1328 -640 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL cap 2640 -624 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res 3680 -720 M180
WINDOW 0 -45 73 Left 2
WINDOW 3 -41 42 Left 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL cap 3776 -624 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C4
SYMATTR Value 100n
SYMBOL e 3104 -336 M90
SYMATTR InstName E1
SYMATTR Value {A}
SYMBOL cap 1072 -384 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value {Cb}
SYMBOL schottky 2640 -736 R180
WINDOW 0 24 72 Left 2
WINDOW 3 26 102 Left 2
SYMATTR InstName D3
SYMATTR Value 1N5818
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 3776 -736 R180
WINDOW 0 -36 34 Left 2
WINDOW 3 -72 -13 Left 2
SYMATTR InstName D4
SYMATTR Value 1N5818
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL nmos 2816 -416 R0
SYMATTR InstName M1
SYMATTR Value irf7309n10
SYMATTR Prefix X
SYMBOL pmos 2816 -640 M180
SYMATTR InstName M2
SYMATTR Value irf7309p
SYMATTR Prefix X
SYMBOL nmos 3584 -416 M0
SYMATTR InstName M3
SYMATTR Value irf7309n10
SYMATTR Prefix X
SYMBOL pmos 3584 -640 R180
SYMATTR InstName M4
SYMATTR Value irf7309p
SYMATTR Prefix X
SYMBOL voltage 1440 -1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 311 33 Left 2
SYMATTR Value PULSE(0 5 0 {.1/fclk} {.1/fclk} {.5/fclk} {1/fclk})
SYMATTR InstName VClk
SYMBOL g2 1520 -400 R0
SYMATTR InstName G1
SYMATTR Value 1e6
SYMBOL res 1584 -400 R0
SYMATTR InstName R10
SYMATTR Value 10
SYMBOL DiffLPF 3088 -848 R0
SYMATTR InstName X1
SYMBOL voltage 1328 -1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VCM
SYMATTR Value 2.5
SYMBOL res 3104 -544 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Rout
SYMATTR Value 8
SYMBOL ind 2960 -544 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 33µ
SYMBOL ind 3264 -544 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 33µ
SYMBOL cap 3120 -640 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C1
SYMATTR Value .047µ
SYMBOL cap 2448 -976 R0
SYMATTR InstName C2
SYMATTR Value 1µ
SYMBOL voltage 2672 -992 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vsense
SYMATTR Value 0
SYMBOL res 1456 -560 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 1Meg
SYMBOL ideal_comparator 1792 -720 R0
SYMATTR InstName X2
SYMBOL ideal_comparator 1792 -336 R0
SYMATTR InstName X3
SYMBOL voltage 1200 -1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 550 -18 Left 2
SYMATTR Value PULSE(5 0 {5/Fclk} 10n 10n 2s 4s)
SYMATTR InstName VPOR
SYMBOL 74hc74 2064 -416 R0
SYMATTR InstName U1
SYMATTR SpiceModel VDD 0
SYMBOL 74hc74 2064 -800 R0
SYMATTR InstName U2
SYMATTR SpiceModel VDD 0
SYMBOL 74act240sim_oe 2288 -848 R0
SYMATTR InstName X8
SYMBOL 74act240sim_oe 2288 -656 R0
SYMATTR InstName X4
SYMBOL 74act240sim_oe 2288 -464 R0
SYMATTR InstName X5
SYMBOL 74act240sim_oe 2288 -288 R0
SYMATTR InstName X6
SYMBOL ind 2624 -1008 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Ltrace
SYMATTR Value 1n
SYMBOL ind 2432 -1008 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Lwire
SYMATTR Value 10n
SYMBOL res 1088 -448 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value {Rp}
TEXT 1312 -48 Left 2 ;.tran 0 {2m+100n} 100n
TEXT 3064 -216 Left 2 !.include irf7309n.spi
TEXT 2688 -624 Left 2 !.ic V(Vg2)=12\n.ic V(Vg1)=0
TEXT 3552 -624 Left 2 !.ic V(Vg4)=12\n.ic V(Vg3)=0
TEXT 1088 -256 Left 2 !.ic V(Vindc)=2.5
TEXT 1752 -1008 Left 2 !.param fclk=500k
TEXT 3064 -184 Left 2 !.include irf7309p.spi
TEXT 3368 -200 Left 2 !.options gmin=1e-9\n.options abstol=1e-9\n.options reltol=0.006\n.options plotwinsize=0
TEXT 3376 -88 Left 2 !.options cshunt=1e-15
TEXT 1800 -512 Left 2 !.ic V(Vint)=2.5
TEXT 2112 -536 Left 2 !.ic v(Q1)=5\n.ic v(Q2)=5\n.ic v(_Q1)=0\n.ic v(_Q2)=0
TEXT 3064 -152 Left 2 !.include 74hc_v_fast.lib
TEXT 1488 -208 Left 2 ;OP_AMP\n MODEL
TEXT 3104 -480 Left 2 ;DIFF AMP\n  MODEL
TEXT 1672 8 Left 2 !.param A=0.1414
TEXT 3424 -56 Left 2 ;Convergence\n   Settings
TEXT 3112 -112 Left 2 ;H-Bridge and\nFlip-Flop Models
TEXT 3040 -736 Left 2 ;External Low Pass Filter\nand 8 Ohm Speaker Load
TEXT 3128 -968 Left 2 ;Speaker and Hearing\nLow Pass Filter Model
TEXT 1512 -712 Left 2 !.param Cb=2u
TEXT 1512 -736 Left 2 !.param Rp=1.5k
TEXT 1512 -784 Left 2 !.param Rin=2.2k
TEXT 1512 -688 Left 2 !.param Cint=150p
TEXT 1672 -16 Left 2 !.param Rf=7.5k
TEXT 1288 128 Left 2 ;.tran 0 {simTime+100n} 100n 1m
TEXT 2384 -96 Left 2 !.four {freq} 5 {3} V(Vll,Vlr)
TEXT 2384 -72 Left 2 !.measure tran pout avg V(Vll,Vlr)*I(Rout)\n.meas TRAN pin AVG {12}*I(Vsense)\n.measure tran efficiency param pout/pin
TEXT 1280 144 Left 2 ;.ac dec 100 .01 1MEG
TEXT 2384 16 Left 2 !.meas tran ppout pp V(Vll,Vlr)\n.meas tran ppin pp V(Vin)\n.meas tran gain param ppout/ppin
TEXT 1752 -976 Left 2 ;.step param fclk 1e6 2e6 100k
TEXT 1752 -944 Left 2 ;.step param fclk 100k 2e6 100k
TEXT 1872 -80 Left 2 ;.step param Rf 2k 10k 1k
TEXT 1280 192 Left 2 ;.step param Rin list 2k 2.2k 2.4k 2.7k 3k 3.3k 3.6k
TEXT 1936 24 Left 2 ;.step param Rin list 2k 2.2k 2.4k
TEXT 1288 168 Left 2 ;.step param Cb 1u 2u 1u
TEXT 1928 48 Left 2 ;.step param Cb list 1u 2u 4.7u 10u
TEXT 1312 16 Left 2 !.tran 0 {40m+100n} 10m
TEXT 1376 -8 Left 2 ;100 Hz tests
TEXT 1352 -72 Left 2 ;1k and 20k tests
TEXT 1600 -80 Left 2 !.param freq=100
RECTANGLE Normal 1616 -176 1456 -416 1
RECTANGLE Normal 3232 -272 3088 -496 1
RECTANGLE Normal 3632 0 3360 -256 1
RECTANGLE Normal 3328 -32 3056 -240 1
RECTANGLE Normal 2968 -756 3372 -516 2
RECTANGLE Normal 3004 -980 3368 -772 2
RECTANGLE Normal 2240 -912 1744 -1072 2
RECTANGLE Normal 1584 32 1280 -96 2
